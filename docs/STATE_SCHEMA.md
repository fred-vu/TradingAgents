# Agent State Schema

This document captures the runtime state keys exchanged between LangGraph nodes. The schema is expressed as a flat dictionary passed through the graph; nested structures are noted where applicable.

## Top-Level Keys
- `messages`: Dialog history used by LangGraph (`list[BaseMessage]`).
- `company_of_interest` (`str`): Active ticker symbol being evaluated.
- `trade_date` (`str`): ISO date under analysis.
- `market_report` (`str`): Narrative generated by the Market Analyst.
- `sentiment_report` (`str`): Summary from the Social Media Analyst.
- `news_report` (`str`): Macro/company news compiled by the News Analyst.
- `fundamentals_report` (`str`): Fundamentals and financial statement analysis.
- `investment_plan` (`str`): Portfolio manager recommendation delivered to the trader.
- `trader_investment_plan` (`str`): Trader’s synthesized action plan (includes FINAL TRANSACTION PROPOSAL tag).
- `final_trade_decision` (`str`): Risk manager’s final BUY/SELL/HOLD verdict.

## Nested Structures

### `investment_debate_state`
Tracks the bullish vs. bearish debate.
- `history` (`str`): Full debate transcript.
- `bull_history` (`str`): Bull analyst contributions.
- `bear_history` (`str`): Bear analyst contributions.
- `current_response` (`str`): Most recent message in the debate.
- `judge_decision` (`str`): Research manager verdict.
- `count` (`int`): Number of debate turns.

### `risk_debate_state`
Tracks the risk analysis round-table.
- `history` (`str`): Combined risk dialog.
- `risky_history` (`str`): Aggressive analyst contributions.
- `safe_history` (`str`): Conservative analyst contributions.
- `neutral_history` (`str`): Neutral analyst contributions.
- `latest_speaker` (`str`): Identifier for the last agent to speak.
- `current_risky_response` (`str`), `current_safe_response` (`str`), `current_neutral_response` (`str`): Most recent statements per analyst.
- `judge_decision` (`str`): Risk manager verdict.
- `count` (`int`): Number of risk debate turns.

## Usage Notes
- Downstream nodes must treat missing keys defensively; use `.get` where keys may not be populated yet.
- Reflection and memory utilities rely on concatenated context strings following the order: market → sentiment → news → fundamentals. Preserve this ordering when extending the state to avoid memory drift.
